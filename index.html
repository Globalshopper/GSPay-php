<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Gspay-php by Globalshopper</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Gspay-php</h1>
      <h2 class="project-tagline">Globalshopper payment service for php platform</h2>
      <a href="https://github.com/Globalshopper/GSPay-php" class="btn">View on GitHub</a>
      <a href="https://github.com/Globalshopper/GSPay-php/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/Globalshopper/GSPay-php/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <p>[TOC]</p>

<h1>
<a id="globalshopper-payment-sdk" class="anchor" href="#globalshopper-payment-sdk" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Globalshopper payment SDK</h1>

<p>GSPay Service SDK support payment, refund, single transaction results query, single order details query functions, following a  introduction of the rules of the integration.</p>

<h1>
<a id="environment-deployment" class="anchor" href="#environment-deployment" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Environment Deployment</h1>

<h2>
<a id="environment-requirements" class="anchor" href="#environment-requirements" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Environment requirements</h2>

<ul>
<li>PHP 5.5 and above</li>
<li>Session mechanisms need to be on the same server</li>
<li>Extension of mcrypt 、bcmath and curl are required；</li>
<li>Payment plugin use the mcrypt_cbc function，this function are deprecated in the php version 5.5. So you need to shut down the error warning of Deprecated</li>
</ul>

<h2>
<a id="configuration-items-in-configphp" class="anchor" href="#configuration-items-in-configphp" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Configuration Items in config.php</h2>

<ul>
<li>Switch to ChinaPay and Globalshopper test or production environment system.</li>
</ul>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c">//Environment switch (true: production environment | false: test environment)</span></span>
<span class="pl-s1"><span class="pl-c1">define</span>(<span class="pl-s"><span class="pl-pds">'</span>ENV_SWITCH<span class="pl-pds">'</span></span>, <span class="pl-c1">false</span>);</span></pre></div>

<ul>
<li>Globalshopper Merchant id 

<ul>
<li>Used as merchant idenfitier in Globalshopper system.</li>
<li>Provided by Globalshopper.</li>
<li>Different in test and production environment.</li>
<li>Provided by Gloalshopper through email after your company register in <a href="http://globalshopper.com.cn">Globalshopper Merchant Management Platform</a>.</li>
</ul>
</li>
</ul>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c">//Globalshopper Merchant Id, provided by GS, String 7.</span></span>
<span class="pl-s1"><span class="pl-smi">$shopperpay_config</span>[<span class="pl-s"><span class="pl-pds">'</span>GSMerId<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>5020001<span class="pl-pds">'</span></span>;</span></pre></div>

<ul>
<li>ChinaPay Merchant id 

<ul>
<li>Used as merchant idenfitier in ChinaPay system.</li>
<li>Provided by ChinaPay.</li>
<li>Different in test and production environment.</li>
<li>Provided by ChinaPay through email in <a href="CP_OpenningLetter.html">Openning Letter</a> after your company get through <a href="CP_Verify.html">ChinaPay Qualitification Verification</a>.</li>
</ul>
</li>
</ul>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c">//Merchant Id, provided by Chinapay, String 15.</span></span>
<span class="pl-s1"><span class="pl-smi">$shopperpay_config</span>[<span class="pl-s"><span class="pl-pds">'</span>MerId<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>808080071198021<span class="pl-pds">'</span></span>;</span></pre></div>

<ul>
<li>Logistic Merchant Id

<ul>
<li>Used as logistic split merchant identifier in ChinaPay system.</li>
<li>Provided by ChinaPay.</li>
<li>Different in test and production environment.</li>
<li>Provided by ChinaPay through email in <a href="CP_OpenningLetter.html">Openning Letter</a> after your company get through <a href="CP_Verify.html">ChinaPay Qualitification Verification</a>.</li>
</ul>
</li>
</ul>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c">//Logistic Merchant Id, provided by ChinaPay.</span></span>
<span class="pl-s1"><span class="pl-smi">$shopperpay_config</span>[<span class="pl-s"><span class="pl-pds">'</span>LogisticsId<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>808080071198022<span class="pl-pds">'</span></span>;</span></pre></div>

<ul>
<li>ChinaPay public key

<ul>
<li>Used for data signature.</li>
<li>Provided by ChinaPay.</li>
<li>Different in test and production environment.</li>
<li>Provided by ChinaPay through email in <a href="CP_OpenningLetter.html">Openning Letter</a> after your company get through <a href="CP_Verify.html">ChinaPay Qualitification Verification</a>.</li>
</ul>
</li>
</ul>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c">//public key of ChinaPay</span></span>
<span class="pl-s1"><span class="pl-c1">define</span>(<span class="pl-s"><span class="pl-pds">'</span>CHINAPAY_PUBKEY<span class="pl-pds">'</span></span>, <span class="pl-c1">dirname</span>(<span class="pl-c1">__FILE__</span>) <span class="pl-k">.</span> <span class="pl-s"><span class="pl-pds">'</span>/key/company/PgPubk.key<span class="pl-pds">'</span></span>);</span></pre></div>

<ul>
<li>Merchant private key

<ul>
<li>Used for veryfy data signature.</li>
<li>Provided by ChinaPay.</li>
<li>Different in test and production environment.</li>
<li>Provided by ChinaPay through email in <a href="CP_OpenningLetter.html">Openning Letter</a> after your company get through <a href="CP_Verify.html">ChinaPay Qualitification Verification</a>.</li>
</ul>
</li>
</ul>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c">//private key of ChinaPay</span></span>
<span class="pl-s1"><span class="pl-c1">define</span>(<span class="pl-s"><span class="pl-pds">'</span>CHINAPAY_PRIVKEY<span class="pl-pds">'</span></span>, <span class="pl-c1">dirname</span>(<span class="pl-c1">__FILE__</span>) <span class="pl-k">.</span> <span class="pl-s"><span class="pl-pds">'</span>/key/thenatural/MerPrK_808080071198021_20160711103730.key<span class="pl-pds">'</span></span>);</span></pre></div>

<ul>
<li>Timezone Setting

<ul>
<li>Your system timezone setting</li>
</ul>
</li>
</ul>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c">//Timezone setting</span></span>
<span class="pl-s1"><span class="pl-c1">date_default_timezone_set</span>(<span class="pl-s"><span class="pl-pds">'</span>Asia/Tokyo<span class="pl-pds">'</span></span>);</span></pre></div>

<ul>
<li>Time zone</li>
</ul>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c">//time zone, Eastren time zone means '+ ', western time zone means '- '.Less than 3 bytes.</span></span>
<span class="pl-s1"><span class="pl-smi">$shopperpay_config</span>[<span class="pl-s"><span class="pl-pds">'</span>TimeZone<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>+09<span class="pl-pds">'</span></span>;</span></pre></div>

<ul>
<li>Country Code</li>
</ul>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c">//Country Code, length 4, area code phone code.(US:0001,JP:0081,CN:0086)</span></span>
<span class="pl-s1"><span class="pl-smi">$shopperpay_config</span>[<span class="pl-s"><span class="pl-pds">'</span>CountryId<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>0086<span class="pl-pds">'</span></span>;</span></pre></div>

<ul>
<li>Currency ID</li>
</ul>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c">//Currency ID, ex:RMB = '156', Japanese yen = 'JPY', Dollar = 'USD'.</span></span>
<span class="pl-s1"><span class="pl-smi">$shopperpay_config</span>[<span class="pl-s"><span class="pl-pds">'</span>CuryId<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>USD<span class="pl-pds">'</span></span>;</span></pre></div>

<ul>
<li>Tag of summer time</li>
</ul>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c">//tag of summer time. '1'means use summer time. '0'means do not use summer time.</span></span>
<span class="pl-s1"><span class="pl-smi">$shopperpay_config</span>[<span class="pl-s"><span class="pl-pds">'</span>DSTFlag<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>0<span class="pl-pds">'</span></span>;</span></pre></div>

<ul>
<li>Order payment result call back address.

<ul>
<li><a href="GS_Inter_01.html">@See Interface Specification 1.Order payment result （See follow process 1.4）</a></li>
<li>Will be called at least 2 times normally.</li>
<li>The first time we will call this to update payment result to you and then skip to your SELLER_RETURN_URL (your customized order confirmation page address).</li>
<li>The second time we will call this just to update payment result to you, in case you did not receive the payment result at the first time , this situation will happen when the order submite page is closed before the payment result call back.</li>
<li>Maybe we will call this more than 2 times , this is becasue our server can not be sure that your web site server have received the payment result data successfully. We will try to resend 5 times at most.</li>
</ul>
</li>
</ul>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c">// Merchant order payment result call back address.</span></span>
<span class="pl-s1"><span class="pl-c1">define</span>(<span class="pl-s"><span class="pl-pds">'</span>SELLER_API<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>http://localhost/shopperpay-sun/demo/seller_api.php<span class="pl-pds">'</span></span>);</span></pre></div>

<ul>
<li>Order payment result page redirect adress.

<ul>
<li>You can customize the order confirm page if you like to show order infromation and payment result.</li>
<li>If you did not config this or we can not find the SELLER_RETURN_URL, we will redirect to <a href="http://www.globalshopper.com.cn/member/order/list.jhtml">Globalshopper's order list page</a>
</li>
</ul>
</li>
</ul>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c">// Merchant order payment result call back interface API private key.</span></span>
<span class="pl-s1"><span class="pl-c1">define</span>(<span class="pl-s"><span class="pl-pds">'</span>SELLER_RETURN_URL<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>http://localhost/shopperpay-sun/demo/return_url.php<span class="pl-pds">'</span></span>);</span></pre></div>

<ul>
<li>Refund result notification call back address.

<ul>
<li><a href="GS_Inter_01.html">@See 1.Refund result notification（See follow process 4.1）</a></li>
<li>Will be called after the refund is accepted by ChinaPay.</li>
<li>Asynchronous notification.</li>
</ul>
</li>
</ul>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c">// Merchant refund result call back address.</span></span>
<span class="pl-s1"><span class="pl-c1">define</span>(<span class="pl-s"><span class="pl-pds">'</span>SELLER_REFUND_API<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>http://localhost/order_refund<span class="pl-pds">'</span></span>);</span></pre></div>

<h1>
<a id="system-interact-flow-chat" class="anchor" href="#system-interact-flow-chat" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>System interact flow chat</h1>

<ul>
<li>Payment Flow chat</li>
</ul>

<p><img src="./assets/gs_payment_flow.png" alt="Payment Flow chat"></p>

<ul>
<li>Query and refund flow chat</li>
</ul>

<p><img src="./assets/gs_payment_flow.png" alt="Payment Flow chat"></p>

<h1>
<a id="interface-specification" class="anchor" href="#interface-specification" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Interface Specification</h1>

<h2>
<a id="order-information-submission" class="anchor" href="#order-information-submission" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Order information submission</h2>

<ul>
<li>Description

<ul>
<li>
<a href="https://github.com/See" class="user-mention">@See</a> [flow chat 1.1]</li>
<li>After the order is submitted, the order information need to be saved to Session, the key is SHOPPER_PAY_ORDER</li>
<li>Attention: We have provided a payment result default page, if you want to redefine it, you should also save the redirect page url in Session with key of SELLER_RETURN_URL. (See flow chat 1.5)</li>
</ul>
</li>
</ul>

<table>
<thead>
<tr>
<th>Parameter</th>
<th>Introduction</th>
<th>Must Need</th>
<th>Field Type</th>
<th>Field Length</th>
<th>Memo</th>
</tr>
</thead>
<tbody>
<tr>
<td>MerOrdId</td>
<td>Order Num in your system</td>
<td>Yes( if there is no GSOrdId)</td>
<td>String</td>
<td>-</td>
<td></td>
</tr>
<tr>
<td>ProTotalAmt</td>
<td>Transaction Amount</td>
<td>NO</td>
<td>String</td>
<td>10</td>
<td>Ex：10.00</td>
</tr>
<tr>
<td>ProductInfo</td>
<td>Product Info</td>
<td>YES</td>
<td>Array</td>
<td>-</td>
<td>Array List，element as follows:</td>
</tr>
</tbody>
</table>

<ul>
<li>ProductInfo elements as follows:</li>
</ul>

<table>
<thead>
<tr>
<th>Parameter</th>
<th>Introduction</th>
<th>Must Need</th>
<th>Field Type</th>
<th>Field Length</th>
<th>Memo</th>
</tr>
</thead>
<tbody>
<tr>
<td>productName</td>
<td>Product Name</td>
<td>YES</td>
<td>String</td>
<td>15</td>
<td>-</td>
</tr>
<tr>
<td>productAttr</td>
<td>Product Attributes</td>
<td>NO</td>
<td>String</td>
<td>-</td>
<td>Include name and value, String of json formatted</td>
</tr>
<tr>
<td>imageUrl</td>
<td>Product image url</td>
<td>YES</td>
<td>String</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>perPrice</td>
<td>Product price</td>
<td>Yes</td>
<td>String</td>
<td>12</td>
<td>-</td>
</tr>
<tr>
<td>quantity</td>
<td>Product quantity</td>
<td>Yes</td>
<td>String</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>perWeight</td>
<td>Weight per product</td>
<td>YES</td>
<td>Decimal(18,4)</td>
<td>-</td>
<td>Including the decimal point and decimal digits (4 bits) a total of 18</td>
</tr>
<tr>
<td>perVolume</td>
<td>Volume per product</td>
<td>YES</td>
<td>Decimal(18,4)</td>
<td>-</td>
<td>Including the decimal point and decimal digits (4 bits) a total of 18</td>
</tr>
<tr>
<td>perTotalAmt</td>
<td>Subtotal per product</td>
<td>YES</td>
<td>String</td>
<td>12</td>
<td>-</td>
</tr>
<tr>
<td>SKU</td>
<td>Product SKU</td>
<td>YES</td>
<td>String</td>
<td>-</td>
<td>Must the same as sku you send to Globalshopper</td>
</tr>
</tbody>
</table>

<ul>
<li>Code Sample </li>
</ul>

<pre lang="jason"><code>{
    "MerOrdId": "2016081700414026",
    "GSMerId": "5020001",
    "LogisticsId": "808080071198022",
    "ProTotalAmt": "240",
    "CuryId": "USD",
    "plugin_version": "v2.0.1",
    "ProductInfo": [
        {
            "productName": "Anti Aging Eye Cream",
            "productAttr": "",
            "imageUrl": "",
            "perPrice": "240.00",
            "quantity": "1",
            "perWeight": "0.5",
            "perVolume": "300",
            "perTotalAmt": "240.00",
            "SKU": "123456789000"
        }
    ]
}
</code></pre>

<h2>
<a id="order-payment-result-notification" class="anchor" href="#order-payment-result-notification" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Order payment result notification</h2>

<ul>
<li>Description

<ul>
<li>
<a href="https://github.com/See" class="user-mention">@See</a> [flow chat 1.3.2]</li>
<li>This interface should be provided by your system.</li>
<li>After payment plugin returned the payment result, the payment plugin will call this interface to notify the payment result and logistic package info with http post mode.</li>
</ul>
</li>
</ul>

<table>
<thead>
<tr>
<th>Parameter</th>
<th>Introduction</th>
<th>Must Need</th>
<th>Field Type</th>
<th>Field Length</th>
<th>Memo</th>
</tr>
</thead>
<tbody>
<tr>
<td>MerOrdId</td>
<td>Order Num in your system</td>
<td>Yes( if there is no GSOrdId)</td>
<td>String</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>GSOrdId</td>
<td>Globalshopper system order Id, related with MerOrdId in your system.</td>
<td>Yes( if there is no MerOrdId)</td>
<td>String</td>
<td>16</td>
<td>Order number in payment result(16 bit)</td>
</tr>
<tr>
<td>OrderInfo</td>
<td>Order payment info</td>
<td>YES</td>
<td>String</td>
<td>Payment result</td>
<td>String of json formatted</td>
</tr>
<tr>
<td>PackageInfo</td>
<td>Logistic package info</td>
<td>YES</td>
<td>String</td>
<td>Logistic package info ,String of json formatted</td>
<td>-</td>
</tr>
<tr>
<td>consigneeInfo</td>
<td>Consignee information</td>
<td>YES</td>
<td>String</td>
<td>String of json formatted. It may be used  to display. If you don't need it, don't care it.</td>
<td></td>
</tr>
</tbody>
</table>

<ul>
<li>OrderInfo elements as follows:</li>
</ul>

<table>
<thead>
<tr>
<th>Parameter</th>
<th>Introduction</th>
<th>Must Need</th>
<th>Field Type</th>
<th>Field Length</th>
<th>Memo</th>
</tr>
</thead>
<tbody>
<tr>
<td>merid</td>
<td>Merchant num</td>
<td>YES</td>
<td>String</td>
<td>15</td>
<td>Distributed by ChinaPay ,String with 15 byte.</td>
</tr>
<tr>
<td>orderno</td>
<td>Order num in ChinaPay</td>
<td>YES</td>
<td>String</td>
<td>16</td>
<td>This orderno value in ChinaPay is the same with the orderNo in GlobalShopper system</td>
</tr>
<tr>
<td>transdate</td>
<td>Transaction Date</td>
<td>YES</td>
<td>String</td>
<td>8</td>
<td>formatted with YYYYMMDD</td>
</tr>
<tr>
<td>amount</td>
<td>Transaction Amount</td>
<td>YES</td>
<td>String</td>
<td>12</td>
<td>ex："000000001234" means 12.34 RMB or $12.34.</td>
</tr>
<tr>
<td>currencycode</td>
<td>Country code</td>
<td>YES</td>
<td>String</td>
<td>4</td>
<td>State phone code</td>
</tr>
<tr>
<td>transtype</td>
<td>Transaction type</td>
<td>YES</td>
<td>String</td>
<td>4</td>
<td>"0001"：consumer transaction，"0002"：refund transaction。</td>
</tr>
<tr>
<td>status</td>
<td>Transaction status</td>
<td>YES</td>
<td>String</td>
<td>4</td>
<td>“1001” means that the transaction payment is successful. The others mean fail.</td>
</tr>
<tr>
<td>checkvalue</td>
<td>Signature value</td>
<td>YES</td>
<td>String</td>
<td>-</td>
<td>String of 256 byte and ASCII,Digital signature for key data submitted for this transaction</td>
</tr>
<tr>
<td>Priv1</td>
<td>Logistic costs</td>
<td>YES</td>
<td>String</td>
<td>-</td>
<td>-</td>
</tr>
</tbody>
</table>

<ul>
<li>PackageInfo elements as follows:</li>
</ul>

<table>
<thead>
<tr>
<th>Parameter</th>
<th>Introduction</th>
<th>Must Need</th>
<th>Field Type</th>
<th>Field Length</th>
<th>Memo</th>
</tr>
</thead>
<tbody>
<tr>
<td>freightSource</td>
<td>Freight amount</td>
<td>YES</td>
<td>String</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>postTaxSource</td>
<td>customs transit tax cost</td>
<td>YES</td>
<td>String</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>sourceExcise</td>
<td>Sourcethe original consumption tax</td>
<td>YES</td>
<td>String</td>
<td>-</td>
<td>Tax on items purchased by the country</td>
</tr>
<tr>
<td>sourceFreightSource</td>
<td>domestic freight in the country where the items are purchased</td>
<td>YES</td>
<td>String</td>
<td>-</td>
<td>-</td>
</tr>
</tbody>
</table>

<ul>
<li>consigneeInfo elements as follows:</li>
</ul>

<table>
<thead>
<tr>
<th>Parameter</th>
<th>Introduction</th>
<th>Must Need</th>
<th>Field Type</th>
<th>Field Length</th>
<th>Memo</th>
</tr>
</thead>
<tbody>
<tr>
<td>contactName</td>
<td>Contact name</td>
<td>YES</td>
<td>String</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>contactPhone</td>
<td>Contact mobile phone</td>
<td>YES</td>
<td>String</td>
<td>-</td>
<td>contactPhone and fixedPhone, at least one non empty</td>
</tr>
<tr>
<td>areaCode</td>
<td>Area code before fixed phone number</td>
<td>NO</td>
<td>String</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>fixedPhone</td>
<td>Fixed phone number</td>
<td>NO</td>
<td>String</td>
<td>-</td>
<td>If the fixedPhone has an extension number, use “-” to link.</td>
</tr>
<tr>
<td>email</td>
<td>Email</td>
<td>NO</td>
<td>String</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>zipCode</td>
<td>Zip code</td>
<td>NO</td>
<td>String</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>countryName</td>
<td>Country name</td>
<td>YES</td>
<td>String</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>provinceName</td>
<td>Province name</td>
<td>YES</td>
<td>String</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>cityName</td>
<td>City name</td>
<td>YES</td>
<td>String</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>districtName</td>
<td>District name</td>
<td>YES</td>
<td>String</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>detailAddress1</td>
<td>Detail address1</td>
<td>YES</td>
<td>String</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>detailAddress2</td>
<td>Detail address2</td>
<td>NO</td>
<td>String</td>
<td>-</td>
<td>If consignee address belongs to America ,it may be used, otherwise it is empty</td>
</tr>
</tbody>
</table>

<ul>
<li>Response json formatted data:</li>
</ul>

<table>
<thead>
<tr>
<th>Parameter</th>
<th>Introduction</th>
<th>Must Need</th>
<th>Field Type</th>
<th>Field Length</th>
<th>Memo</th>
</tr>
</thead>
<tbody>
<tr>
<td>isSuccess</td>
<td>isSuccess</td>
<td>YES</td>
<td>Bool</td>
<td>1：success，0：fail</td>
<td></td>
</tr>
<tr>
<td>errorMessage</td>
<td>Reson of failure</td>
<td>NO</td>
<td>String</td>
<td>Decription of failure，null when succuss</td>
<td></td>
</tr>
</tbody>
</table>

<h2>
<a id="single-order-payment-status-query" class="anchor" href="#single-order-payment-status-query" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Single order payment status query</h2>

<ul>
<li>Description

<ul>
<li>
<a href="https://github.com/See" class="user-mention">@See</a> [flow chat 2.1]</li>
<li>Attention only return the order payment status and information with no packageInfo and consigneeInfo.</li>
<li>If you want to query the packageInfo and consigneeInfo you should call the [GSOrder information query][##GSOrder information query] interface.</li>
</ul>
</li>
</ul>

<table>
<thead>
<tr>
<th>Parameter</th>
<th>Introduction</th>
<th>Must Need</th>
<th>Field Type</th>
<th>Field Length</th>
<th>Memo</th>
</tr>
</thead>
<tbody>
<tr>
<td>MerOrdId</td>
<td>Order Num in your system</td>
<td>Yes( if there is no GSOrdId)</td>
<td>String</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>GSOrdId</td>
<td>Globalshopper system order Id, related with MerOrdId in your system.</td>
<td>Yes( if there is no MerOrdId)</td>
<td>String</td>
<td>16</td>
<td>Order number in payment result(16 bit)</td>
</tr>
<tr>
<td>order_date</td>
<td>Order date returned</td>
<td>YES</td>
<td>String</td>
<td>8</td>
<td>YYYYMMDD format,Same as transdate in interface [Order payment result]</td>
</tr>
<tr>
<td>resv</td>
<td>Merchant retention area</td>
<td>NO</td>
<td>String</td>
<td>empty string or others</td>
<td></td>
</tr>
</tbody>
</table>

<ul>
<li>Response json formatted data:</li>
</ul>

<table>
<thead>
<tr>
<th>Parameter</th>
<th>Introduction</th>
<th>Must Need</th>
<th>Field Type</th>
<th>Field Length</th>
<th>Memo</th>
</tr>
</thead>
<tbody>
<tr>
<td>MerOrdId</td>
<td>Order Num in your system</td>
<td>Yes( if there is no GSOrdId)</td>
<td>String</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>GSOrdId</td>
<td>Globalshopper system order Id, related with MerOrdId in your system.</td>
<td>Yes( if there is no MerOrdId)</td>
<td>String</td>
<td>16</td>
<td>Order number in payment result(16 bit)</td>
</tr>
<tr>
<td>OrderInfo</td>
<td>Order payment info</td>
<td>YES</td>
<td>String</td>
<td>Payment result</td>
<td>String of json formatted</td>
</tr>
</tbody>
</table>

<ul>
<li>OrderInfo elements as follows:</li>
</ul>

<table>
<thead>
<tr>
<th>Parameter</th>
<th>Introduction</th>
<th>Must Need</th>
<th>Field Type</th>
<th>Field Length</th>
<th>Memo</th>
</tr>
</thead>
<tbody>
<tr>
<td>merid</td>
<td>Merchant num</td>
<td>YES</td>
<td>String</td>
<td>15</td>
<td>Distributed by ChinaPay ,String with 15 byte.</td>
</tr>
<tr>
<td>orderno</td>
<td>Order num in ChinaPay</td>
<td>YES</td>
<td>String</td>
<td>16</td>
<td>This orderno value in ChinaPay is the same with the orderNo in GlobalShopper system</td>
</tr>
<tr>
<td>transdate</td>
<td>Transaction Date</td>
<td>YES</td>
<td>String</td>
<td>8</td>
<td>formatted with YYYYMMDD</td>
</tr>
<tr>
<td>amount</td>
<td>Transaction Amount</td>
<td>YES</td>
<td>String</td>
<td>12</td>
<td>ex："000000001234" means 12.34 RMB or $12.34.</td>
</tr>
<tr>
<td>currencycode</td>
<td>Country code</td>
<td>YES</td>
<td>String</td>
<td>4</td>
<td>State phone code</td>
</tr>
<tr>
<td>transtype</td>
<td>Transaction type</td>
<td>YES</td>
<td>String</td>
<td>4</td>
<td>"0001"：consumer transaction，"0002"：refund transaction。</td>
</tr>
<tr>
<td>status</td>
<td>Transaction status</td>
<td>YES</td>
<td>String</td>
<td>4</td>
<td>“1001” means that the transaction payment is successful. The others mean fail.</td>
</tr>
<tr>
<td>checkvalue</td>
<td>Signature value</td>
<td>YES</td>
<td>String</td>
<td>-</td>
<td>String of 256 byte and ASCII,Digital signature for key data submitted for this transaction</td>
</tr>
<tr>
<td>Priv1</td>
<td>Logistic costs</td>
<td>YES</td>
<td>String</td>
<td>-</td>
<td>-</td>
</tr>
</tbody>
</table>

<h2>
<a id="refund-application" class="anchor" href="#refund-application" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Refund application</h2>

<ul>
<li>Description

<ul>
<li>
<a href="https://github.com/See" class="user-mention">@See</a> [flow chat 3.1]</li>
<li>Attention this interface just submite a refund application, the result can just tell you wether the application is accepted not the refund.</li>
<li>The final refund result will be return through [Refund result notification][##Refund result notification] interface.</li>
</ul>
</li>
</ul>

<table>
<thead>
<tr>
<th>Parameter</th>
<th>Introduction</th>
<th>Must Need</th>
<th>Field Type</th>
<th>Field Length</th>
<th>Memo</th>
</tr>
</thead>
<tbody>
<tr>
<td>MerOrdId</td>
<td>Order Num in your system</td>
<td>Yes( if there is no GSOrdId)</td>
<td>String</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>GSOrdId</td>
<td>Globalshopper system order Id, related with MerOrdId in your system.</td>
<td>Yes( if there is no MerOrdId)</td>
<td>String</td>
<td>16</td>
<td>Order number in payment result(16 bit)</td>
</tr>
<tr>
<td>order_date</td>
<td>Order date returned</td>
<td>YES</td>
<td>String</td>
<td>8</td>
<td>YYYYMMDD format,Same as transdate in interface [Order payment result]</td>
</tr>
<tr>
<td>refund_amount</td>
<td>Refund amount</td>
<td>-</td>
<td>String</td>
<td>-</td>
<td>For example 12.34, 95.00</td>
</tr>
<tr>
<td>priv1</td>
<td>Merchant private area</td>
<td>-</td>
<td>String</td>
<td>-</td>
<td>The length is less than 40,length 20 is fittable. merchants themselves define the content, but can not be repeated, in order to avoid the refund of duplicate submission, thus verify the content is repeated to determine have already submitted, if submitted that the sum refund has been received and no treatment.</td>
</tr>
</tbody>
</table>

<ul>
<li>Response json formatted data:</li>
</ul>

<table>
<thead>
<tr>
<th>Parameter</th>
<th>Introduction</th>
<th>Must Need</th>
<th>Field Type</th>
<th>Field Length</th>
<th>Memo</th>
</tr>
</thead>
<tbody>
<tr>
<td>isSuccess</td>
<td>isSuccess</td>
<td>YES</td>
<td>Bool</td>
<td>1：success，0：fail</td>
<td></td>
</tr>
<tr>
<td>errorMessage</td>
<td>Reson of failure</td>
<td>NO</td>
<td>String</td>
<td>Decription of failure，null when succuss</td>
<td></td>
</tr>
</tbody>
</table>

<h2>
<a id="refund-result-notification" class="anchor" href="#refund-result-notification" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Refund result notification</h2>

<ul>
<li>Description

<ul>
<li>
<a href="https://github.com/See" class="user-mention">@See</a> [flow chat 4.1.1]</li>
<li>Attention this notification will be send to you after ChinaPay return the final refund result.</li>
<li>The Plugin will call the SELLER_REFUND_API in config.php.</li>
</ul>
</li>
</ul>

<table>
<thead>
<tr>
<th>Parameter</th>
<th>Introduction</th>
<th>Must Need</th>
<th>Field Type</th>
<th>Field Length</th>
<th>Memo</th>
</tr>
</thead>
<tbody>
<tr>
<td>MerOrdId</td>
<td>Order Num in your system</td>
<td>Yes( if there is no GSOrdId)</td>
<td>String</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>GSOrdId</td>
<td>Globalshopper system order Id, related with MerOrdId in your system.</td>
<td>Yes( if there is no MerOrdId)</td>
<td>String</td>
<td>16</td>
<td>Order number in payment result(16 bit)</td>
</tr>
<tr>
<td>OrderInfo</td>
<td>Order payment info</td>
<td>YES</td>
<td>String</td>
<td>Payment result</td>
<td>String of json formatted</td>
</tr>
</tbody>
</table>

<ul>
<li>Response json formatted data:</li>
</ul>

<table>
<thead>
<tr>
<th>Parameter</th>
<th>Introduction</th>
<th>Must Need</th>
<th>Field Type</th>
<th>Field Length</th>
<th>Memo</th>
</tr>
</thead>
<tbody>
<tr>
<td>isSuccess</td>
<td>isSuccess</td>
<td>YES</td>
<td>Bool</td>
<td>1：success，0：fail</td>
<td></td>
</tr>
<tr>
<td>errorMessage</td>
<td>Reson of failure</td>
<td>NO</td>
<td>String</td>
<td>Decription of failure，null when succuss</td>
<td></td>
</tr>
</tbody>
</table>

<h2>
<a id="gsorder-information-query" class="anchor" href="#gsorder-information-query" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>GSOrder information query</h2>

<ul>
<li>Description

<ul>
<li>
<a href="https://github.com/See" class="user-mention">@See</a> [flow chat 5.1]</li>
<li>Attention only return the packageInfo and consigneeInfo with no orderInfo.</li>
</ul>
</li>
</ul>

<table>
<thead>
<tr>
<th>Parameter</th>
<th>Introduction</th>
<th>Must Need</th>
<th>Field Type</th>
<th>Field Length</th>
<th>Memo</th>
</tr>
</thead>
<tbody>
<tr>
<td>MerOrdId</td>
<td>Order Num in your system</td>
<td>Yes( if there is no GSOrdId)</td>
<td>String</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>GSOrdId</td>
<td>Globalshopper system order Id, related with MerOrdId in your system.</td>
<td>Yes( if there is no MerOrdId)</td>
<td>String</td>
<td>16</td>
<td>Order number in payment result(16 bit)</td>
</tr>
<tr>
<td>PackageInfo</td>
<td>Logistic package info</td>
<td>YES</td>
<td>String</td>
<td>Logistic package info ,String of json formatted</td>
<td>-</td>
</tr>
<tr>
<td>consigneeInfo</td>
<td>Consignee information</td>
<td>YES</td>
<td>String</td>
<td>String of json formatted. It may be used  to display. If you don't need it, don't care it.</td>
<td></td>
</tr>
<tr>
<td>GSOrderStatus</td>
<td>Order status in Globalshopper</td>
<td>YES</td>
<td>String</td>
<td>-</td>
<td>unpay,paid,cancel,shipping,completed</td>
</tr>
</tbody>
</table>

<ul>
<li>PackageInfo elements as follows:</li>
</ul>

<table>
<thead>
<tr>
<th>Parameter</th>
<th>Introduction</th>
<th>Must Need</th>
<th>Field Type</th>
<th>Field Length</th>
<th>Memo</th>
</tr>
</thead>
<tbody>
<tr>
<td>freightSource</td>
<td>Freight amount</td>
<td>YES</td>
<td>String</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>postTaxSource</td>
<td>customs transit tax cost</td>
<td>YES</td>
<td>String</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>sourceExcise</td>
<td>Sourcethe original consumption tax</td>
<td>YES</td>
<td>String</td>
<td>-</td>
<td>Tax on items purchased by the country</td>
</tr>
<tr>
<td>sourceFreightSource</td>
<td>domestic freight in the country where the items are purchased</td>
<td>YES</td>
<td>String</td>
<td>-</td>
<td>-</td>
</tr>
</tbody>
</table>

<ul>
<li>consigneeInfo elements as follows:</li>
</ul>

<table>
<thead>
<tr>
<th>Parameter</th>
<th>Introduction</th>
<th>Must Need</th>
<th>Field Type</th>
<th>Field Length</th>
<th>Memo</th>
</tr>
</thead>
<tbody>
<tr>
<td>contactName</td>
<td>Contact name</td>
<td>YES</td>
<td>String</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>contactPhone</td>
<td>Contact mobile phone</td>
<td>YES</td>
<td>String</td>
<td>-</td>
<td>contactPhone and fixedPhone, at least one non empty</td>
</tr>
<tr>
<td>areaCode</td>
<td>Area code before fixed phone number</td>
<td>NO</td>
<td>String</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>fixedPhone</td>
<td>Fixed phone number</td>
<td>NO</td>
<td>String</td>
<td>-</td>
<td>If the fixedPhone has an extension number, use “-” to link.</td>
</tr>
<tr>
<td>email</td>
<td>Email</td>
<td>NO</td>
<td>String</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>zipCode</td>
<td>Zip code</td>
<td>NO</td>
<td>String</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>countryName</td>
<td>Country name</td>
<td>YES</td>
<td>String</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>provinceName</td>
<td>Province name</td>
<td>YES</td>
<td>String</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>cityName</td>
<td>City name</td>
<td>YES</td>
<td>String</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>districtName</td>
<td>District name</td>
<td>YES</td>
<td>String</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>detailAddress1</td>
<td>Detail address1</td>
<td>YES</td>
<td>String</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>detailAddress2</td>
<td>Detail address2</td>
<td>NO</td>
<td>String</td>
<td>-</td>
<td>If consignee address belongs to America ,it may be used, otherwise it is empty</td>
</tr>
</tbody>
</table>

<h1>
<a id="version" class="anchor" href="#version" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Version</h1>

<ul>
<li>
<p>Version 2.0.1</p>

<ul>
<li>Add an interface [7.0 Single order information query]</li>
<li>
<p>Adjust the interface fields.</p>

<ul>
<li>Replace [OrdId] with [MerOrdId].</li>
<li>Add [GSOrdId] filed.</li>
<li>Delete [ApiKey] filed.</li>
<li>Delete [packageNo],[merId],[orderGuid],[orderNo],[transAmtSource]</li>
<li>Delete [IDNumber] </li>
</ul>
</li>
</ul>
</li>
<li><p>Version 1.0.0</p></li>
</ul>

<h1>
<a id="related-article" class="anchor" href="#related-article" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Related Article</h1>

<p><a href="CP_OpenningLetter.html">Openning Letter</a>
<a href="CP_Verify.html">ChinaPay Qualitification Verification</a></p>

<h1>
<a id="about" class="anchor" href="#about" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>About</h1>

<p>This plugin and this sample file is proudly brought to you by the <a href="http://globalshopper.com.cn">Globalshopper team</a></p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/Globalshopper/GSPay-php">Gspay-php</a> is maintained by <a href="https://github.com/Globalshopper">Globalshopper</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
